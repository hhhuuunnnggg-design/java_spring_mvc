## ğŸ›’ Laptopshop 2025 â€” Spring Boot MVC (JSP)

á»¨ng dá»¥ng bÃ¡n laptop vá»›i Ä‘áº§y Ä‘á»§ luá»“ng ngÆ°á»i dÃ¹ng: duyá»‡t sáº£n pháº©m, giá» hÃ ng, Ä‘áº·t hÃ ng, thanh toÃ¡n VNPay, lá»‹ch sá»­ Ä‘Æ¡n, phÃ¢n quyá»n, vÃ  Ä‘Äƒng nháº­p OAuth2 (Google/GitHub).

---

## âœ¨ TÃ­nh nÄƒng ná»•i báº­t

- ğŸ” XÃ¡c thá»±c & phÃ¢n quyá»n: Spring Security, Remember-me, session JDBC, redirect theo vai trÃ² (User/Admin)
- ğŸ”‘ ÄÄƒng nháº­p OAuth2: Google (UI link `/oauth2/authorization/google`), GitHub (UI sáºµn, cÃ³ thá»ƒ cáº¥u hÃ¬nh thÃªm)
- ğŸ›ï¸ Sáº£n pháº©m: phÃ¢n trang, sáº¯p xáº¿p theo giÃ¡, chi tiáº¿t sáº£n pháº©m (`/product`, `/product/{id}`)
- ğŸ›’ Giá» hÃ ng: thÃªm/xÃ³a/cáº­p nháº­t, giá»¯ tráº¡ng thÃ¡i theo session
- ğŸ§¾ Äáº·t hÃ ng & thanh toÃ¡n: táº¡o Ä‘Æ¡n, chá»n phÆ°Æ¡ng thá»©c COD/VNPay, sinh `paymentRef` theo `UUID`
- ğŸ’³ VNPay sandbox: build URL cÃ³ `hmacSHA512`, redirect sang gateway, xá»­ lÃ½ callback táº¡i `/thanks` Ä‘á»ƒ cáº­p nháº­t `paymentStatus`
- ğŸ“œ Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng: `/order-history` (theo user)
- ğŸ‘¨â€ğŸ’¼ Khu vá»±c Admin: Ä‘iá»u hÆ°á»›ng sau Ä‘Äƒng nháº­p tá»›i `/admin` Ä‘á»‘i vá»›i `ROLE_ADMIN`

---

## ğŸ› ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

- â˜• Java 17, Spring Boot
- ğŸ§° Spring MVC (JSP), Spring Security, OAuth2 Client
- ğŸ—ƒï¸ Spring Data JPA (MySQL), Hibernate Validator
- ğŸ—‚ï¸ Spring Session JDBC (lÆ°u session DB), Remember-me Services

---

## ğŸ”Œ Cáº¥u hÃ¬nh & biáº¿n mÃ´i trÆ°á»ng

File `src/main/resources/application.properties`:

- CSDL MySQL (máº·c Ä‘á»‹nh):
  - `spring.datasource.url=jdbc:mysql://localhost:3306/laptopshop`
  - `spring.datasource.username=root`
  - `spring.jpa.hibernate.ddl-auto=update`
- Session JDBC:
  - `spring.session.store-type=jdbc`
  - `spring.session.jdbc.initialize-schema=always`
- VNPay sandbox:
  - `hoidanit.vnpay.tmn-code=...`
  - `hoidanit.vnpay.hash-secret=...`
  - `hoidanit.vnpay.vnp-url=https://sandbox.vnpayment.vn/paymentv2/vpcpay.html`
  - `hoidanit.vnpay.vnp-return-url=http://localhost:8080/thanks`
- OAuth2 Google:
  - `spring.security.oauth2.client.registration.google.client-id=...`
  - `spring.security.oauth2.client.registration.google.client-secret=...`
  - `spring.security.oauth2.client.registration.google.scope=email,profile`

---

## ğŸš€ HÆ°á»›ng dáº«n cháº¡y (Windows)

```bash
mvnw.cmd clean install
mvnw.cmd spring-boot:run
```

Hoáº·c cháº¡y trá»±c tiáº¿p class `vn.hoidanit.laptopshop.LaptopshopApplication` tá»« IDE.

Máº·c Ä‘á»‹nh á»©ng dá»¥ng cháº¡y cá»•ng `8080`.

---

## ğŸ” Báº£o máº­t & OAuth2

- Cáº¥u hÃ¬nh táº¡i `vn.hoidanit.laptopshop.config.SecurityConfiguration`:
  - Cho phÃ©p truy cáº­p cÃ´ng khai cÃ¡c tÃ i nguyÃªn tÄ©nh vÃ  trang cÃ´ng cá»™ng
  - Báº¯t buá»™c xÃ¡c thá»±c cho cÃ¡c route cÃ²n láº¡i
  - `formLogin` vÃ  `oauth2Login` dÃ¹ng chung `customSuccessHandler()` Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng theo vai trÃ²
  - `SpringSessionRememberMeServices` báº­t cháº¿ Ä‘á»™ always-remember
- `CustomUserDetailsService`: load user theo email, map quyá»n `ROLE_{role}` tá»« DB
- `CustomOAuth2UserService`: xá»­ lÃ½ thÃ´ng tin tá»« provider (Google), cÃ³ thá»ƒ map/Ä‘á»“ng bá»™ user ná»™i bá»™
- UI login thÃªm liÃªn káº¿t SSO: `/oauth2/authorization/google` vÃ  `/oauth2/authorization/github`

---

## ğŸ’³ Luá»“ng thanh toÃ¡n VNPay (sandbox)

1. NgÆ°á»i dÃ¹ng Ä‘áº·t hÃ ng táº¡i `/checkout` vÃ  submit `/place-order`
2. Náº¿u chá»n VNPay: sinh `uuid` lÃ m `paymentRef`, build URL VNPay báº±ng `VNPayService.generateVNPayURL(...)` vÃ  redirect
3. VNPay gá»i ngÆ°á»£c vá» `/thanks` (theo `vnp-return-url`)
4. á» `/thanks`, Ä‘á»c `vnp_ResponseCode` vÃ  `vnp_TxnRef` Ä‘á»ƒ cáº­p nháº­t `paymentStatus` qua `productService.updatePaymentStatus`

---

## ğŸ“¦ Module & endpoint tiÃªu biá»ƒu

- Client controllers: `HomePageController`, `ItemController`, API giá» hÃ ng (`CartAPI`)
- Admin: Ä‘iá»u hÆ°á»›ng máº·c Ä‘á»‹nh sau Ä‘Äƒng nháº­p náº¿u cÃ³ `ROLE_ADMIN`
- Endpoint chÃ­nh:
  - `/` Trang chá»§, `/product`, `/product/{id}`
  - `/cart`, `/checkout`, `/place-order`, `/thanks`, `/order-history`
  - `/login`, `/register`, `/access-deny`
  - `/oauth2/authorization/google`, `/oauth2/authorization/github`

---

## ğŸ§¾ MÃ´ hÃ¬nh dá»¯ liá»‡u (rÃºt gá»n)

- `User(id, email, password, fullname, role, provider, ...)`
- `Role(id, name, description)` â†’ 1:N `User`
- `Product(id, name, price, image, detaildesc, shortdesc, quantity, sold, ...)`
- `Cart(id, user)` â†” `CartDetail(id, cart, product, quantity)`
- `Order(id, user, totalPrice, receiver..., status, paymentRef, paymentStatus, paymentMethod)` â†” `OrderDetail`

---

## ğŸ§­ Nhá»¯ng gÃ¬ tÃ´i Ä‘Ã£ lÃ m trong `LaptopshopApplication.java`

- Khá»Ÿi táº¡o entry point Spring Boot báº±ng `@SpringBootApplication` + `main()`
- Duy trÃ¬ phÆ°Æ¡ng Ã¡n loáº¡i trá»« `SecurityAutoConfiguration` (comment sáºµn) Ä‘á»ƒ linh hoáº¡t trong debug/demo báº£o máº­t
- Äáº·t package gá»‘c `vn.hoidanit.laptopshop` giÃºp component scan toÃ n bá»™ layer MVC/Service/Repository

TrÃ­ch Ä‘oáº¡n:

```java
@SpringBootApplication
// @SpringBootApplication(exclude =
// org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration.class)
public class LaptopshopApplication {
    public static void main(String[] args) {
        SpringApplication.run(LaptopshopApplication.class, args);
    }
}
```

---
